<!DOCTYPE html>
<html lang="pt-br" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° Gemini Dev Assistant üíª</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css" />
    <style>
        body { max-width: 1200px; margin: 0 auto; padding: 20px; }
        #chat-container { height: 70vh; overflow-y: scroll; padding: 15px; border-radius: var(--border-radius); border: 1px solid var(--border-color); margin-bottom: 20px; }
        .message-box { padding: 10px; margin-bottom: 10px; border-radius: var(--border-radius); }
        .user-message { background-color: var(--pico-secondary-background); text-align: right; }
        .ai-message { background-color: var(--pico-primary-background); text-align: left; }
        #input-area { display: flex; gap: 10px; }
        #chat-input { flex-grow: 1; }
        .github-tools { margin-top: 20px; padding: 15px; background-color: var(--pico-secondary-background); border-radius: var(--border-radius); }
    </style>
</head>
<body>
    <hgroup>
        <h1>ü§ñ Gemini Dev Assistant</h1>
        <p>Chat com IA para gerenciar e corrigir c√≥digo no GitHub.</p>
    </hgroup>
    <hr>

    <div id="chat-container">
    </div>

    <form id="chat-form">
        <div id="input-area">
            <input type="text" id="chat-input" name="prompt" placeholder="Digite sua solicita√ß√£o (Ex: 'Crie um arquivo index.js no repo X com um hello world')">
            <button type="submit">Enviar</button>
        </div>
    </form>

    <div class="github-tools">
        <h3>üîß Configura√ß√µes e A√ß√µes GitHub</h3>
        <p>A√ß√µes r√°pidas para criar, ler, editar ou corrigir arquivos no seu reposit√≥rio.</p>
        <button onclick="handleTool('read')">Ler Arquivo</button>
        <button onclick="handleTool('edit')">Editar/Criar Arquivo</button>
        <button onclick="handleTool('autofix')">Auto-Corrigir Erros</button>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const chatForm = document.getElementById('chat-form');
        const STORAGE_KEY = 'geminiChatHistory';
        const API_KEY = 'AIzaSyB7ou_FpcqAcb21dv5BKoXZl_ve2NHhA3I'; 
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent';

        function saveChatHistory() {
            const historyElements = chatContainer.querySelectorAll('.message-box');
            const historyToSave = [];

            historyElements.forEach(el => {
                historyToSave.push({
                    sender: el.classList.contains('user-message') ? 'user' : 'ai',
                    text: el.textContent.trim()
                });
            });

            localStorage.setItem(STORAGE_KEY, JSON.stringify(historyToSave));
        }

        function appendMessage(sender, text, shouldSave = true) {
            const messageEl = document.createElement('div');
            messageEl.classList.add('message-box');
            messageEl.classList.add(sender === 'user' ? 'user-message' : 'ai-message');
            messageEl.textContent = text;
            
            chatContainer.appendChild(messageEl);
            
            chatContainer.scrollTop = chatContainer.scrollHeight;

            if (shouldSave) {
                saveChatHistory();
            }
        }

        function loadChatHistory() {
            const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            
            if (history.length === 0) {
                history.push({ 
                    sender: 'ai', 
                    text: 'Ol√°! Eu sou o Gemini, seu assistente de c√≥digo. Como posso ajudar no seu reposit√≥rio GitHub hoje?' 
                });
            }

            chatContainer.innerHTML = '';
            history.forEach(message => appendMessage(message.sender, message.text, false));
        }

        chatForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const input = document.getElementById('chat-input');
            const prompt = input.value.trim();

            if (!prompt) return;
            if (API_KEY === 'AIzaSyB7ou_FpcqAcb21dv5BKoXZl_ve2NHhA3I') {
                appendMessage('ai', 'Erro: Por favor, insira sua chave de API Gemini no c√≥digo JavaScript para que o chat funcione.');
                input.value = '';
                return;
            }

            appendMessage('user', prompt); 
            input.value = '';

            try {
                const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                const contents = history.map(msg => ({
                    role: msg.sender === 'user' ? 'user' : 'model',
                    parts: [{ text: msg.text }]
                }));
                
                const response = await fetch(`${GEMINI_API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        contents: [...contents, { role: 'user', parts: [{ text: prompt }] }],
                        config: { 
                            systemInstruction: "Voc√™ √© um assistente de desenvolvimento Gemini, focado em ajudar com tarefas de c√≥digo, gerenciamento de reposit√≥rios GitHub (criar, ler, editar, corrigir) e perguntas t√©cnicas. Responda de forma concisa e √∫til."
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Erro de API: ${response.statusText}`);
                }

                const data = await response.json();
                
                const aiResponseText = data.candidates[0]?.content?.parts[0]?.text || 'Desculpe, a IA n√£o retornou uma resposta v√°lida.'; 

                appendMessage('ai', aiResponseText); 

            } catch (error) {
                console.error('Erro ao comunicar com a API:', error);
                appendMessage('ai', `Desculpe, ocorreu um erro: ${error.message}`);
            }
        });

        function handleTool(action) {
            const actionMap = {
                'read': 'Qual arquivo voc√™ deseja ler? (Ex: Ler o README.md no meu/repo)',
                'edit': 'Informe o reposit√≥rio, caminho e conte√∫do para criar/editar um arquivo. (Ex: Criar index.html em meu/repo com <h1>Hello</h1>)',
                'autofix': 'Informe o caminho do arquivo no reposit√≥rio que precisa de corre√ß√£o. (Ex: Auto-corrigir bugs no src/script.js em meu/repo)'
            };
            
            const initialPrompt = actionMap[action] || 'A√ß√£o desconhecida.';
            
            appendMessage('ai', `A√ß√£o r√°pida: ${initialPrompt}`);
        }

        loadChatHistory();
    </script>
</body>
</html>
